Code                                          | Description
----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------
#!/bin/sh                                     | Shebang line to specify the shell used for the script
echo \"CheckFWNow...\"                          | Print \"CheckFWNow...\" to the console
fwinfo=\"/tmp/fwinfo.xml\"                      | Assign /tmp/fwinfo.xml to variable fwinfo
model=\"`xmldbc-g/runtime/device/modelname`\"   | Assign modelname retrieved from the device to variable model 
srv=\"wrpd.dlink.com.tw\"                       | Assign wrpd.dlink.com.tw to variable srv
reqstr=\"/router/firmware/query.asp\"           | Assign /router/firmware/query.asp to variable reqstr
old_major=`cat /etc/config/buildver | cut -d'.' -f1`               | Assign first part of buildver from /etc/config/ to old_major
old_minor=`cat /etc/config/buildver | cut -d'.' -f2 | cut -c1-2`    | Assign second part of buildver from /etc/config/ to old_minor
buildver=\"_0\"$old_major$old_minor             | Assign old_major and old_minor to buildver after prepending \"_0\" to the string
global=\"Bx_Default_FW\"$buildver               | Assign global to \"Bx_Default_FW\" concatenated with buildver
reqstr=$reqstr\"?model=$model_$global\"          | Update reqstr by concatenating model, \"_\" and global
reqstr=\"GET$reqstr HTTP/1.1\
Accept:*/*\
User-Agent:Mozilla/4.0(compatible;MSIE6.0;WindowsNT5.1;SV1)\
Host:$srv\
Connection:Close\"   | Update reqstr by concatenating GET request, HTTP/1.1 version, Accept header, User-Agent information, Host, and Connection 
rm -f $fwinfo                                 | Remove /tmp/fwinfo.xml file if it exists
xmldbc -X /runtime/firmware                    | Run xmldbc script to retrieve firmware information
echo \"tcprequest $reqstr\"                      | Output \"tcprequest\" followed by the updated reqstr to the console
\"$srv\" 80 -f $fwinfo -t 5 -s `tcprequest $reqstr \"$srv\" 80 -f $fwinfo -t 5 -s`     | Execute tcprequest command to connect to server and retrieve firmware information
if [ -f $fwinfo ]; then                       | Check if /tmp/fwinfo.xml file exists
    #getfirmwareinformation
    new_major=`grep Major /tmp/fwinfo.xml | sed 's/^[ \\t]*//' | sed 's/<Major>//' | sed 's/<\\/Major>//'`     | Retrieve the new firmware major version from /tmp/fwinfo.xml
    new_minor=`grep Minor /tmp/fwinfo.xml | sed 's/^[ \\t]*//' | sed 's/<Minor>//' | sed 's/<\\/Minor>//'`     | Retrieve the new firmware minor version from /tmp/fwinfo.xml
    if [ \"$new_major\" != \"\" ] || [ \"$new_minor\" != \"\" ]; then          | Check if new_major and new_minor are not empty
        xmldbc -s /runtime/firmware/fwversion/Major \"$new_major\"      | Set the new firmware major version in the device
        xmldbc -s /runtime/firmware/fwversion/Minor \"$new_minor\"      | Set the new firmware minor version in the device
        if [ \"$new_major\" != \"\" ]; then                               | Check if new_major is non-empty
            if [ $new_major -gt $old_major -o $new_major -eq $old_major -a $new_minor -gt $old_minor ]; then      | Check if new firmware version is greater than current firmware version
                echo \"Have new Firmware\"                              | Output \"Have new Firmware\" to the console
                xmldbc -s /runtime/firmware/havenewfirmware 1        | Set havenewfirmware to 1 in the device
            fi
        fi
    fi
fi                                             | End of if statement and end of the script.
